From 59f2093a76f9694571292f8d1752f98b3475c6de Mon Sep 17 00:00:00 2001
From: Icenowy Zheng <uwu@icenowy.me>
Date: Fri, 4 Apr 2025 11:26:40 +0800
Subject: [PATCH 1/2] hardcode supported display drivers

Signed-off-by: Icenowy Zheng <uwu@icenowy.me>
---
 src/gallium/targets/dri/meson.build | 2 +-
 src/gallium/targets/dri/target.c    | 3 +++
 src/pvr/wsi/pvr_wsi.c               | 6 ++++++
 3 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/gallium/targets/dri/meson.build b/src/gallium/targets/dri/meson.build
index f9cccfd3d2c..f5fe79ac9bf 100644
--- a/src/gallium/targets/dri/meson.build
+++ b/src/gallium/targets/dri/meson.build
@@ -126,7 +126,7 @@ foreach d : [[with_gallium_kmsro, [
              [with_gallium_zink, 'zink_dri.so'],
              [with_gallium_d3d12, 'd3d12_dri.so'],
              [with_gallium_asahi, 'asahi_dri.so'],
-             [with_gallium_pvr, 'pvr_dri.so'],
+             [with_gallium_pvr, ['pvr_dri.so', 'spacemit_dri.so', 'es_drm_dri.so', 'vs_drm_dri.so'] ],
              [with_gallium_pvr_alias, gallium_pvr_alias + '_dri.so'],
              [with_gallium_sgx, ['sgx_dri.so', 'pvr_dri.so']],
              [with_gallium_sgx_alias, gallium_sgx_alias + '_dri.so']]
diff --git a/src/gallium/targets/dri/target.c b/src/gallium/targets/dri/target.c
index 3da378e571d..c61b9924d1a 100644
--- a/src/gallium/targets/dri/target.c
+++ b/src/gallium/targets/dri/target.c
@@ -174,6 +174,9 @@ DEFINE_LOADER_DRM_ENTRYPOINT(d3d12);
 
 #if defined(GALLIUM_PVR)
 DEFINE_LOADER_PVR_ENTRYPOINT(pvr);
+DEFINE_LOADER_PVR_ENTRYPOINT(spacemit);
+DEFINE_LOADER_PVR_ENTRYPOINT(es_drm);
+DEFINE_LOADER_PVR_ENTRYPOINT(vs_drm);
 #endif
 
 #if defined(GALLIUM_PVR_ALIAS)
diff --git a/src/pvr/wsi/pvr_wsi.c b/src/pvr/wsi/pvr_wsi.c
index 688059c0337..f4ce3fda429 100644
--- a/src/pvr/wsi/pvr_wsi.c
+++ b/src/pvr/wsi/pvr_wsi.c
@@ -55,6 +55,12 @@ pvr_mesa_wsi_can_present_on_device(VkPhysicalDevice pdevice, int fd)
 #if defined(PVR_DISPLAY_DRIVER_STRING)
       ret = !strcmp(version->name, PVR_DISPLAY_DRIVER_STRING);
 #endif
+      if (!ret)
+         ret = !strcmp(version->name, "es_drm");
+      if (!ret)
+         ret = !strcmp(version->name, "vs_drm");
+      if (!ret)
+         ret = !strcmp(version->name, "spacemit");
       if (!ret)
          ret = !strcmp(version->name, "pvr");
    }
-- 
2.51.0

